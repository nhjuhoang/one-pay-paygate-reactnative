{"version":3,"names":["LINKING_ERROR","Platform","select","ios","default","OnepayPaygate","NativeModules","Proxy","get","Error","OPCurrency","OPErrorCase","multiply","a","b","secureHashQueries","queries","hashKeyCustomer","generateSecureHash","createReturnUrl","paymentEntity","op_createReturnUrlFromUrlScheme","urlSchemes","urlScheme","op_createPaymentUrl","version","VERSION_PAYGATE","code","Date","now","title","merchant","amountString","Math","floor","amount","returnUrl","ticketNo","TICKET_NO","localeName","OS","SettingsManager","settings","AppleLocale","AppleLanguages","I18nManager","localeIdentifier","languageString","includes","vpc_Version","vpc_Command","COMMAND_PAYGATE","vpc_AccessCode","accessCode","vpc_Merchant","vpc_Locale","vpc_ReturnURL","vpc_MerchTxnRef","vpc_OrderInfo","orderInformation","vpc_Amount","vpc_TicketNo","Title","vpc_Currency","currency","vnd","vpc_Theme","VPC_THEME","AgainLink","AGAIN_LINK","customerPhone","length","vpc_Customer_Phone","customerEmail","vpc_Customer_Email","customerId","vpc_Customer_Id","secureHash","Object","assign","hashKey","vpc_SecureHash","console","log","queriesString","entries","map","value","filter","join","encodeURI","LINK_PAYGATE","paymentUrl","op_openWithPayment","payment","op_openWithUrl","Promise","resolve","reject","open","then","resultUrl","obj","getQueryParamsFromUrl","result","isSuccess","vpc_TxnResponseCode","card","vpc_Card","cardNumber","vpc_CardNum","command","merchTxnRef","message","vpc_Message","orderInfo","payChannel","vpc_PayChannel","transactionNo","vpc_TransactionNo","catch","error"],"sources":["index.tsx"],"sourcesContent":["import { NativeModules, Platform } from 'react-native';\nimport {\n  AGAIN_LINK,\n  COMMAND_PAYGATE,\n  LINK_PAYGATE,\n  TICKET_NO,\n  VERSION_PAYGATE,\n  VPC_THEME,\n} from './constants';\nimport { getQueryParamsFromUrl } from './utils';\n\nconst LINKING_ERROR =\n  `The package 'react-native-onepay-paygate' doesn't seem to be linked. Make sure: \\n\\n` +\n  Platform.select({ ios: \"- You have run 'pod install'\\n\", default: '' }) +\n  '- You rebuilt the app after installing the package\\n' +\n  '- You are not using Expo managed workflow\\n';\n\nconst OnepayPaygate = NativeModules.OnepayPaygate\n  ? NativeModules.OnepayPaygate\n  : new Proxy(\n      {},\n      {\n        get() {\n          throw new Error(LINKING_ERROR);\n        },\n      }\n    );\n\nexport enum OPCurrency {\n  vnd,\n  usd,\n}\n\nexport enum OPErrorCase {\n  MOBILE_NOT_APP_BANKING, // app mobile banking doesn't install or not config in LSApplicationQueriesSchemes\n  NOT_CONNECT_WEB_ONEPAY, // app not connect web onepay.Please check the information set onepay sent.\n  NOT_FOUND_APP_BANKING, // App banking isn't exist. Contact the onepay developer with information of the message field in error.\n  WEB_ONEPAY_STATUS_500, // app not connect web onepay.Contact onepay for support.\n}\n\nexport interface OPPaymentEntity {\n  amount: number;\n  orderInformation: string;\n  currency: OPCurrency;\n  accessCode: string;\n  merchant: string;\n  hashKey: string;\n  urlSchemes: string;\n  customerPhone?: string;\n  customerEmail?: string;\n  customerId?: string;\n}\n\nexport interface OPPaymentResult {\n  isSuccess: boolean;\n  amount?: string;\n  card?: string;\n  cardNumber?: string;\n  command?: string;\n  merchTxnRef?: string;\n  merchant?: string;\n  message?: string;\n  orderInfo?: string;\n  payChannel?: string;\n  transactionNo?: string;\n  version?: string;\n}\n\nexport interface OPErrorResult {\n  errorCase: OPErrorCase;\n}\n\nexport interface OPPaymentUrl {\n  paymentUrl: string;\n  returnUrl: string;\n}\n\nexport function multiply(a: number, b: number): Promise<number> {\n  return OnepayPaygate.multiply(a, b);\n}\n\nfunction secureHashQueries(\n  queries: { [key: string]: string },\n  hashKeyCustomer: string\n): Promise<string> {\n  return OnepayPaygate.generateSecureHash(queries, hashKeyCustomer);\n}\n\nconst createReturnUrl = (paymentEntity: OPPaymentEntity) => {\n  return op_createReturnUrlFromUrlScheme(paymentEntity.urlSchemes);\n};\n\nexport function op_createReturnUrlFromUrlScheme(urlScheme: string): string {\n  return `${urlScheme}://onepay/`;\n}\n\nexport async function op_createPaymentUrl(\n  paymentEntity: OPPaymentEntity\n): Promise<OPPaymentUrl> {\n  let version = VERSION_PAYGATE;\n  let code = Date.now();\n  let title = paymentEntity.merchant;\n  let amountString = `${Math.floor(paymentEntity.amount * 100)}`;\n  let returnUrl = createReturnUrl(paymentEntity);\n  let ticketNo = TICKET_NO;\n  let localeName: string =\n    Platform.OS === 'ios'\n      ? NativeModules.SettingsManager.settings.AppleLocale ||\n        NativeModules.SettingsManager.settings.AppleLanguages[0] //iOS 13\n      : NativeModules.I18nManager.localeIdentifier;\n  let languageString = localeName.includes('vi') ? 'vn' : 'en';\n  let queries: { [key: string]: string } = {\n    vpc_Version: version,\n    vpc_Command: COMMAND_PAYGATE,\n    vpc_AccessCode: paymentEntity.accessCode,\n    vpc_Merchant: paymentEntity.merchant,\n    vpc_Locale: languageString,\n    vpc_ReturnURL: returnUrl,\n    vpc_MerchTxnRef: `${code}`,\n    vpc_OrderInfo: paymentEntity.orderInformation,\n    vpc_Amount: amountString,\n    vpc_TicketNo: ticketNo,\n    Title: title,\n    vpc_Currency: paymentEntity.currency === OPCurrency.vnd ? 'VND' : 'USD',\n    vpc_Theme: VPC_THEME,\n    AgainLink: AGAIN_LINK,\n  };\n  // let queriesMap = new Map(Object.entries(queries));\n  if (paymentEntity.customerPhone && paymentEntity.customerPhone.length > 0) {\n    // queriesMap.set('vpc_Customer_Phone', paymentEntity.customerPhone);\n    queries.vpc_Customer_Phone = paymentEntity.customerPhone;\n  }\n  if (paymentEntity.customerEmail && paymentEntity.customerEmail.length > 0) {\n    // queriesMap.set('vpc_Customer_Email', paymentEntity.customerEmail);\n    queries.vpc_Customer_Email = paymentEntity.customerEmail;\n  }\n  if (paymentEntity.customerId && paymentEntity.customerId.length > 0) {\n    // queriesMap.set('vpc_Customer_Id', paymentEntity.customerId);\n    queries.vpc_Customer_Id = paymentEntity.customerId;\n  }\n  let secureHash = await secureHashQueries(\n    // Object.fromEntries(queriesMap),\n    Object.assign({}, queries),\n    paymentEntity.hashKey\n  );\n  // queriesMap.set('vpc_SecureHash', secureHash);\n  queries.vpc_SecureHash = secureHash;\n  // queries.vpc_SecureHash = await OnepayPaygate.generateSecureHash(\n  //   queries,\n  //   paymentEntity.hashKey\n  // );\n  console.log('queries.vpc_SecureHash : ' + queries.vpc_SecureHash);\n  let queriesString = Object.entries(queries)\n    .map((value) => `${value[0]}=${value[1]}`)\n    .filter((value) => value.length > 0)\n    .join('&');\n  // console.log('queries map entries: ' + Array.from(queriesMap).map(value ));\n  // let queriesString = Object.entries(queriesMap)\n  //   .map((value) => `${value[0]}=${value[1]}`)\n  //   .filter((value) => value.length > 0)\n  //   .join('&');\n  // queriesString += `&vpc_SecureHash=${secureHash}`;\n  console.log('queries string: ' + queriesString);\n  console.log('encode uri: ' + encodeURI(LINK_PAYGATE + '?' + queriesString));\n  return {\n    paymentUrl: encodeURI(`${LINK_PAYGATE}?${queriesString}`),\n    // paymentUrl: `${LINK_PAYGATE}?${queriesString}`,\n    returnUrl: createReturnUrl(paymentEntity),\n  };\n}\n\nexport async function op_openWithPayment(\n  paymentEntity: OPPaymentEntity\n): Promise<OPPaymentResult> {\n  let payment = await op_createPaymentUrl(paymentEntity);\n  return op_openWithUrl(payment.paymentUrl, payment.returnUrl);\n}\n\nexport function op_openWithUrl(\n  paymentUrl: string,\n  returnUrl: string\n): Promise<OPPaymentResult> {\n  return new Promise((resolve, reject) => {\n    OnepayPaygate.open(paymentUrl, returnUrl)\n      .then((resultUrl: string) => {\n        console.log('result url: ' + resultUrl);\n        let obj = getQueryParamsFromUrl(resultUrl);\n        let result: OPPaymentResult = {\n          isSuccess: obj.vpc_TxnResponseCode === '0',\n          amount: obj.vpc_Amount,\n          card: obj.vpc_Card,\n          cardNumber: obj.vpc_CardNum,\n          command: obj.vpc_Command,\n          merchTxnRef: obj.vpc_MerchTxnRef,\n          merchant: obj.vpc_Merchant,\n          message: obj.vpc_Message,\n          orderInfo: obj.vpc_OrderInfo,\n          payChannel: obj.vpc_PayChannel,\n          transactionNo: obj.vpc_TransactionNo,\n          version: obj.vpc_Version,\n        };\n        resolve(result);\n      })\n      .catch((error: any) => {\n        reject(error);\n      });\n  });\n}\n"],"mappings":"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"}