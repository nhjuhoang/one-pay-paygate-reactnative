{"version":3,"names":["NativeModules","Platform","AGAIN_LINK","COMMAND_PAYGATE","LINK_PAYGATE","TICKET_NO","VERSION_PAYGATE","VPC_THEME","getQueryParamsFromUrl","LINKING_ERROR","select","ios","default","OnepayPaygate","Proxy","get","Error","OPCurrency","OPErrorCase","multiply","a","b","secureHashQueries","queries","hashKeyCustomer","generateSecureHash","createReturnUrl","paymentEntity","op_createReturnUrlFromUrlScheme","urlSchemes","urlScheme","op_createPaymentUrl","version","code","Date","now","title","merchant","amountString","Math","floor","amount","returnUrl","ticketNo","localeName","OS","SettingsManager","settings","AppleLocale","AppleLanguages","I18nManager","localeIdentifier","languageString","includes","vpc_Version","vpc_Command","vpc_AccessCode","accessCode","vpc_Merchant","vpc_Locale","vpc_ReturnURL","vpc_MerchTxnRef","vpc_OrderInfo","orderInformation","vpc_Amount","vpc_TicketNo","Title","vpc_Currency","currency","vnd","vpc_Theme","AgainLink","customerPhone","length","vpc_Customer_Phone","customerEmail","vpc_Customer_Email","customerId","vpc_Customer_Id","secureHash","Object","assign","hashKey","vpc_SecureHash","console","log","queriesString","entries","map","value","filter","join","encodeURI","paymentUrl","op_openWithPayment","payment","op_openWithUrl","Promise","resolve","reject","open","then","resultUrl","obj","result","isSuccess","vpc_TxnResponseCode","card","vpc_Card","cardNumber","vpc_CardNum","command","merchTxnRef","message","vpc_Message","orderInfo","payChannel","vpc_PayChannel","transactionNo","vpc_TransactionNo","catch","error"],"sources":["index.tsx"],"sourcesContent":["import { NativeModules, Platform } from 'react-native';\nimport {\n  AGAIN_LINK,\n  COMMAND_PAYGATE,\n  LINK_PAYGATE,\n  TICKET_NO,\n  VERSION_PAYGATE,\n  VPC_THEME,\n} from './constants';\nimport { getQueryParamsFromUrl } from './utils';\n\nconst LINKING_ERROR =\n  `The package 'react-native-onepay-paygate' doesn't seem to be linked. Make sure: \\n\\n` +\n  Platform.select({ ios: \"- You have run 'pod install'\\n\", default: '' }) +\n  '- You rebuilt the app after installing the package\\n' +\n  '- You are not using Expo managed workflow\\n';\n\nconst OnepayPaygate = NativeModules.OnepayPaygate\n  ? NativeModules.OnepayPaygate\n  : new Proxy(\n      {},\n      {\n        get() {\n          throw new Error(LINKING_ERROR);\n        },\n      }\n    );\n\nexport enum OPCurrency {\n  vnd,\n  usd,\n}\n\nexport enum OPErrorCase {\n  MOBILE_NOT_APP_BANKING, // app mobile banking doesn't install or not config in LSApplicationQueriesSchemes\n  NOT_CONNECT_WEB_ONEPAY, // app not connect web onepay.Please check the information set onepay sent.\n  NOT_FOUND_APP_BANKING, // App banking isn't exist. Contact the onepay developer with information of the message field in error.\n  WEB_ONEPAY_STATUS_500, // app not connect web onepay.Contact onepay for support.\n}\n\nexport interface OPPaymentEntity {\n  amount: number;\n  orderInformation: string;\n  currency: OPCurrency;\n  accessCode: string;\n  merchant: string;\n  hashKey: string;\n  urlSchemes: string;\n  customerPhone?: string;\n  customerEmail?: string;\n  customerId?: string;\n}\n\nexport interface OPPaymentResult {\n  isSuccess: boolean;\n  amount?: string;\n  card?: string;\n  cardNumber?: string;\n  command?: string;\n  merchTxnRef?: string;\n  merchant?: string;\n  message?: string;\n  orderInfo?: string;\n  payChannel?: string;\n  transactionNo?: string;\n  version?: string;\n}\n\nexport interface OPErrorResult {\n  errorCase: OPErrorCase;\n}\n\nexport interface OPPaymentUrl {\n  paymentUrl: string;\n  returnUrl: string;\n}\n\nexport function multiply(a: number, b: number): Promise<number> {\n  return OnepayPaygate.multiply(a, b);\n}\n\nfunction secureHashQueries(\n  queries: { [key: string]: string },\n  hashKeyCustomer: string\n): Promise<string> {\n  return OnepayPaygate.generateSecureHash(queries, hashKeyCustomer);\n}\n\nconst createReturnUrl = (paymentEntity: OPPaymentEntity) => {\n  return op_createReturnUrlFromUrlScheme(paymentEntity.urlSchemes);\n};\n\nexport function op_createReturnUrlFromUrlScheme(urlScheme: string): string {\n  return `${urlScheme}://onepay/`;\n}\n\nexport async function op_createPaymentUrl(\n  paymentEntity: OPPaymentEntity\n): Promise<OPPaymentUrl> {\n  let version = VERSION_PAYGATE;\n  let code = Date.now();\n  let title = paymentEntity.merchant;\n  let amountString = `${Math.floor(paymentEntity.amount * 100)}`;\n  let returnUrl = createReturnUrl(paymentEntity);\n  let ticketNo = TICKET_NO;\n  let localeName: string =\n    Platform.OS === 'ios'\n      ? NativeModules.SettingsManager.settings.AppleLocale ||\n        NativeModules.SettingsManager.settings.AppleLanguages[0] //iOS 13\n      : NativeModules.I18nManager.localeIdentifier;\n  let languageString = localeName.includes('vi') ? 'vn' : 'en';\n  let queries: { [key: string]: string } = {\n    vpc_Version: version,\n    vpc_Command: COMMAND_PAYGATE,\n    vpc_AccessCode: paymentEntity.accessCode,\n    vpc_Merchant: paymentEntity.merchant,\n    vpc_Locale: languageString,\n    vpc_ReturnURL: returnUrl,\n    vpc_MerchTxnRef: `${code}`,\n    vpc_OrderInfo: paymentEntity.orderInformation,\n    vpc_Amount: amountString,\n    vpc_TicketNo: ticketNo,\n    Title: title,\n    vpc_Currency: paymentEntity.currency === OPCurrency.vnd ? 'VND' : 'USD',\n    vpc_Theme: VPC_THEME,\n    AgainLink: AGAIN_LINK,\n  };\n  // let queriesMap = new Map(Object.entries(queries));\n  if (paymentEntity.customerPhone && paymentEntity.customerPhone.length > 0) {\n    // queriesMap.set('vpc_Customer_Phone', paymentEntity.customerPhone);\n    queries.vpc_Customer_Phone = paymentEntity.customerPhone;\n  }\n  if (paymentEntity.customerEmail && paymentEntity.customerEmail.length > 0) {\n    // queriesMap.set('vpc_Customer_Email', paymentEntity.customerEmail);\n    queries.vpc_Customer_Email = paymentEntity.customerEmail;\n  }\n  if (paymentEntity.customerId && paymentEntity.customerId.length > 0) {\n    // queriesMap.set('vpc_Customer_Id', paymentEntity.customerId);\n    queries.vpc_Customer_Id = paymentEntity.customerId;\n  }\n  let secureHash = await secureHashQueries(\n    // Object.fromEntries(queriesMap),\n    Object.assign({}, queries),\n    paymentEntity.hashKey\n  );\n  // queriesMap.set('vpc_SecureHash', secureHash);\n  queries.vpc_SecureHash = secureHash;\n  // queries.vpc_SecureHash = await OnepayPaygate.generateSecureHash(\n  //   queries,\n  //   paymentEntity.hashKey\n  // );\n  console.log('queries.vpc_SecureHash : ' + queries.vpc_SecureHash);\n  let queriesString = Object.entries(queries)\n    .map((value) => `${value[0]}=${value[1]}`)\n    .filter((value) => value.length > 0)\n    .join('&');\n  // console.log('queries map entries: ' + Array.from(queriesMap).map(value ));\n  // let queriesString = Object.entries(queriesMap)\n  //   .map((value) => `${value[0]}=${value[1]}`)\n  //   .filter((value) => value.length > 0)\n  //   .join('&');\n  // queriesString += `&vpc_SecureHash=${secureHash}`;\n  console.log('queries string: ' + queriesString);\n  console.log('encode uri: ' + encodeURI(LINK_PAYGATE + '?' + queriesString));\n  return {\n    paymentUrl: encodeURI(`${LINK_PAYGATE}?${queriesString}`),\n    // paymentUrl: `${LINK_PAYGATE}?${queriesString}`,\n    returnUrl: createReturnUrl(paymentEntity),\n  };\n}\n\nexport async function op_openWithPayment(\n  paymentEntity: OPPaymentEntity\n): Promise<OPPaymentResult> {\n  let payment = await op_createPaymentUrl(paymentEntity);\n  return op_openWithUrl(payment.paymentUrl, payment.returnUrl);\n}\n\nexport function op_openWithUrl(\n  paymentUrl: string,\n  returnUrl: string\n): Promise<OPPaymentResult> {\n  return new Promise((resolve, reject) => {\n    OnepayPaygate.open(paymentUrl, returnUrl)\n      .then((resultUrl: string) => {\n        console.log('result url: ' + resultUrl);\n        let obj = getQueryParamsFromUrl(resultUrl);\n        let result: OPPaymentResult = {\n          isSuccess: obj.vpc_TxnResponseCode === '0',\n          amount: obj.vpc_Amount,\n          card: obj.vpc_Card,\n          cardNumber: obj.vpc_CardNum,\n          command: obj.vpc_Command,\n          merchTxnRef: obj.vpc_MerchTxnRef,\n          merchant: obj.vpc_Merchant,\n          message: obj.vpc_Message,\n          orderInfo: obj.vpc_OrderInfo,\n          payChannel: obj.vpc_PayChannel,\n          transactionNo: obj.vpc_TransactionNo,\n          version: obj.vpc_Version,\n        };\n        resolve(result);\n      })\n      .catch((error: any) => {\n        reject(error);\n      });\n  });\n}\n"],"mappings":"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"}